<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qriosity - Air-Gap Transfer</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <!-- Mode Selector -->
  <div id="mode-select" class="screen active">
    <h1>QRIOSITY</h1>
    <p>Air-Gap File Transfer</p>
    <div class="mode-buttons">
      <button id="btn-send">SEND</button>
      <button id="btn-receive">RECEIVE</button>
    </div>
    <p class="tagline">No network required. Transfer via QR.</p>
    <a href="experiments/index.html" class="experiments-link">Experiments</a>
  </div>

  <!-- Sender Screen -->
  <div id="sender" class="screen">
    <header><button class="back-btn">&larr; Back</button><span>SEND MODE</span></header>
    <main>
      <input type="file" id="file-input" class="visually-hidden">

      <div class="qr-container drop-zone" id="qr-container">
        <div id="qr-placeholder" class="drop-zone-content">
          <div class="drop-zone-icon">+</div>
          <div>Drop file here or tap to select</div>
        </div>
        <canvas id="qr-canvas" style="display:none;"></canvas>
      </div>

      <div class="sender-controls" id="sender-controls">
        <div class="mode-selector" id="qr-mode-selector">
          <button class="mode-btn active" data-mode="0">Standard (BW)</button>
          <button class="mode-btn" data-mode="1">Color CMY</button>
          <button class="mode-btn" data-mode="2">Color RGB</button>
        </div>
        <div class="slider-group">
          <label for="data-slider">Data</label>
          <input type="range" id="data-slider" min="0" max="3" value="1" step="1">
          <span id="data-display">Normal (200B)</span>
        </div>
        <div class="slider-group">
          <label for="size-slider">Size</label>
          <input type="range" id="size-slider" min="0" max="2" value="1" step="1">
          <span id="size-display">Medium (320px)</span>
        </div>
        <div class="slider-group">
          <label for="speed-slider">Speed</label>
          <input type="range" id="speed-slider" min="0" max="2" value="1" step="1">
          <span id="speed-display">Normal (100ms)</span>
        </div>
        <div class="file-status">
          <span id="file-info">No file</span>
          <span id="stat-symbol" class="symbol-count"></span>
        </div>
        <div class="action-buttons">
          <button id="btn-action-send" disabled>Start</button>
          <button id="btn-stop-send" class="secondary" disabled>Stop</button>
        </div>
      </div>
    </main>
  </div>

  <!-- Receiver Screen -->
  <div id="receiver" class="screen">
    <header><button class="back-btn">&larr; Back</button><span>RECEIVE MODE</span></header>
    <main>
      <div class="video-container">
        <video id="camera-video" autoplay playsinline muted></video>
        <svg class="qr-overlay" id="qr-overlay">
          <polygon id="qr-polygon" points="" />
        </svg>
        <button id="btn-camera-switch" class="floating-camera-btn" title="Switch camera">
          <span class="camera-icon"></span>
        </button>
        <div id="camera-picker" class="camera-picker hidden">
          <label for="camera-dropdown" class="visually-hidden">Select camera</label>
          <select id="camera-dropdown"></select>
        </div>
      </div>

      <div class="mode-override" id="mode-override">
        <span class="mode-status" id="mode-status">Auto-detecting...</span>
        <div class="mode-selector secondary" id="receiver-mode-selector">
          <button class="mode-btn" data-mode="0">BW</button>
          <button class="mode-btn" data-mode="1">CMY</button>
          <button class="mode-btn" data-mode="2">RGB</button>
        </div>
      </div>

      <div class="receiver-status" id="receiver-status-bar">
        <div class="status-scanning" id="status-scanning">
          <span>Scanning...</span>
          <span id="stat-symbols">0 codes</span>
          <button id="btn-reset-receiver" class="reset-btn">Reset</button>
        </div>
        <div class="status-receiving hidden" id="status-receiving">
          <div class="status-file-row">
            <span id="file-name-display">-</span>
            <span class="stats-inline">
              <span id="stat-blocks">0/0</span>
              <span id="stat-rate">-</span>
              <span id="stat-eta">-</span>
            </span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width:0"></div>
          </div>
        </div>
        <div class="status-complete hidden" id="status-complete">
          <div class="status-file-row">
            <span id="complete-file-name">-</span>
            <span id="complete-rate" class="complete-rate"></span>
          </div>
          <div class="complete-actions">
            <button id="btn-download">Download</button>
            <button id="btn-receive-another" class="secondary">Receive Another</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Error Banner -->
  <div id="error-banner" class="hidden">
    <span id="error-message"></span>
    <button id="error-dismiss">&times;</button>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
