<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beam Me Up - Air-Gap Transfer</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <!-- Mode Selector -->
  <div id="mode-select" class="screen active">
    <h1>BEAM ME UP</h1>
    <p>Air-Gap File Transfer</p>
    <div class="transfer-sections">
      <div class="transfer-section">
        <h2>QR Transfer</h2>
        <div class="mode-buttons vertical">
          <button id="btn-send">SEND</button>
          <button id="btn-receive">RECEIVE</button>
        </div>
        <p class="section-desc">Standard QR format<br>~3-32 kbps</p>
      </div>
      <div class="transfer-divider"></div>
      <div class="transfer-section">
        <h2>CIMBAR Transfer</h2>
        <div class="mode-buttons vertical">
          <button id="btn-cimbar-send">SEND</button>
          <button id="btn-cimbar-receive">RECEIVE</button>
        </div>
        <p class="section-desc">High-density color<br>~850 kbps</p>
      </div>
    </div>
  </div>

  <!-- Sender Screen -->
  <div id="sender" class="screen">
    <header><button class="back-btn">&larr; Back</button><span>SEND MODE</span></header>
    <main>
      <input type="file" id="file-input" class="visually-hidden">

      <div class="qr-container drop-zone" id="qr-container">
        <div id="qr-placeholder" class="drop-zone-content">
          <div class="drop-zone-icon">+</div>
          <div>Drop file here or tap to select</div>
        </div>
        <canvas id="qr-canvas" style="display:none;"></canvas>
      </div>

      <div class="sender-controls" id="sender-controls">
        <div class="mode-selector" id="qr-mode-selector">
          <button class="mode-btn active" data-mode="0">BW</button>
          <button class="mode-btn" data-mode="1">CMY</button>
          <button class="mode-btn" data-mode="2">RGB</button>
        </div>
        <div class="slider-group">
          <label for="data-slider">Data</label>
          <input type="range" id="data-slider" min="0" max="3" value="1" step="1">
          <span id="data-display">Normal (200B)</span>
        </div>
        <div class="slider-group">
          <label for="size-slider">Size</label>
          <input type="range" id="size-slider" min="0" max="2" value="1" step="1">
          <span id="size-display">Medium (320px)</span>
        </div>
        <div class="slider-group">
          <label for="speed-slider">Speed</label>
          <input type="range" id="speed-slider" min="0" max="2" value="1" step="1">
          <span id="speed-display">Normal (100ms)</span>
        </div>
        <div class="file-status">
          <span id="file-info">No file</span>
          <span id="stat-symbol" class="symbol-count"></span>
        </div>
        <div class="action-buttons">
          <button id="btn-action-send" disabled>Start</button>
          <button id="btn-stop-send" class="secondary" disabled>Stop</button>
        </div>
      </div>
    </main>
  </div>

  <!-- Receiver Screen -->
  <div id="receiver" class="screen">
    <header><button class="back-btn">&larr; Back</button><span>RECEIVE MODE</span></header>
    <main>
      <div class="video-container">
        <video id="camera-video" autoplay playsinline muted></video>
        <svg class="qr-overlay" id="qr-overlay">
          <polygon id="qr-polygon" points="" />
        </svg>
        <button id="btn-camera-switch" class="floating-camera-btn" title="Switch camera">
          <span class="camera-icon"></span>
        </button>
        <div id="camera-picker" class="camera-picker hidden">
          <label for="camera-dropdown" class="visually-hidden">Select camera</label>
          <select id="camera-dropdown"></select>
        </div>
      </div>

      <div class="mode-override" id="mode-override">
        <span class="mode-status" id="mode-status">Auto-detecting...</span>
        <div class="mode-selector secondary" id="receiver-mode-selector">
          <button class="mode-btn" data-mode="0">BW</button>
          <button class="mode-btn" data-mode="1">CMY</button>
          <button class="mode-btn" data-mode="2">RGB</button>
        </div>
      </div>
      <div id="debug-panel" style="margin-top:8px;border:2px solid #00d4ff;border-radius:4px;">
        <div style="display:flex;align-items:center;background:#16213e;border-bottom:1px solid #333;">
          <div id="debug-current" style="flex:1;font-size:14px;color:#00d4ff;padding:6px 8px;font-family:monospace;text-align:center;">waiting...</div>
          <button id="btn-copy-log" style="padding:4px 10px;margin:4px;font-size:11px;background:#333;color:#0f0;border:1px solid #0f0;border-radius:3px;cursor:pointer;">Copy</button>
        </div>
        <div id="debug-log" style="font-size:11px;color:#0f0;padding:8px;background:#000;font-family:monospace;height:100px;overflow-y:auto;white-space:pre-wrap;"></div>
      </div>

      <div class="receiver-status" id="receiver-status-bar">
        <div class="status-scanning" id="status-scanning">
          <span>Scanning...</span>
          <span id="stat-symbols">0 codes</span>
          <button id="btn-reset-receiver" class="reset-btn">Reset</button>
        </div>
        <div class="status-receiving hidden" id="status-receiving">
          <div class="status-file-row">
            <span id="file-name-display">-</span>
            <span class="stats-inline">
              <span id="stat-blocks">0/0</span>
              <span id="stat-rate">-</span>
              <span id="stat-eta">-</span>
            </span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width:0"></div>
          </div>
        </div>
        <div class="status-complete hidden" id="status-complete">
          <div class="status-file-row">
            <span id="complete-file-name">-</span>
            <span id="complete-rate" class="complete-rate"></span>
          </div>
          <div class="complete-actions">
            <button id="btn-download">Download</button>
            <button id="btn-receive-another" class="secondary">Receive Another</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- CIMBAR Sender Screen -->
  <div id="cimbar-sender" class="screen">
    <header><button class="back-btn">&larr; Back</button><span>CIMBAR SEND</span></header>
    <main>
      <input type="file" id="cimbar-file-input" class="visually-hidden">

      <div class="cimbar-container drop-zone empty" id="cimbar-container">
        <div id="cimbar-placeholder" class="drop-zone-content">
          <div class="drop-zone-icon" id="cimbar-placeholder-icon">+</div>
          <div id="cimbar-placeholder-text">Drop file here or tap to select</div>
          <div id="cimbar-loading" class="loading-text hidden">Loading CIMBAR...</div>
        </div>
        <canvas id="cimbar-canvas" style="display:none;"></canvas>
      </div>

      <div class="sender-controls" id="cimbar-sender-controls">
        <div class="slider-group">
          <label for="cimbar-size-slider">Size</label>
          <input type="range" id="cimbar-size-slider" min="0" max="3" value="2" step="1">
          <span id="cimbar-size-display">Large (720px)</span>
        </div>
        <div class="slider-group">
          <label for="cimbar-speed-slider">Speed</label>
          <input type="range" id="cimbar-speed-slider" min="0" max="2" value="1" step="1">
          <span id="cimbar-speed-display">Normal (15 FPS)</span>
        </div>
        <div class="file-status">
          <span id="cimbar-file-info">No file</span>
          <span id="cimbar-estimate" class="estimate"></span>
        </div>
        <div class="action-buttons">
          <button id="btn-cimbar-action" disabled>Start</button>
          <button id="btn-cimbar-stop" class="secondary" disabled>Stop</button>
        </div>
      </div>
    </main>
  </div>

  <!-- CIMBAR Receiver Screen -->
  <div id="cimbar-receiver" class="screen">
    <header><button class="back-btn">&larr; Back</button><span>CIMBAR RECEIVE</span></header>
    <main>
      <div class="video-container">
        <video id="cimbar-video" autoplay playsinline muted></video>
        <div class="cimbar-crosshairs" id="cimbar-crosshairs">
          <div class="crosshair-corner tl"></div>
          <div class="crosshair-corner tr"></div>
          <div class="crosshair-corner bl"></div>
          <div class="crosshair-corner br"></div>
        </div>
        <button id="btn-cimbar-camera-switch" class="floating-camera-btn" title="Switch camera">
          <span class="camera-icon"></span>
        </button>
      </div>

      <div class="receiver-status" id="cimbar-status-bar">
        <div class="status-scanning" id="cimbar-status-scanning">
          <span>Scanning...</span>
          <span id="cimbar-stat-frames">0 frames</span>
          <button id="btn-cimbar-reset" class="reset-btn">Reset</button>
        </div>
        <div class="status-receiving hidden" id="cimbar-status-receiving">
          <div class="status-file-row">
            <span id="cimbar-file-name">-</span>
            <span class="stats-inline">
              <span id="cimbar-stat-progress">0%</span>
              <span id="cimbar-stat-rate">-</span>
            </span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="cimbar-progress-fill" style="width:0"></div>
          </div>
        </div>
        <div class="status-complete hidden" id="cimbar-status-complete">
          <div class="status-file-row">
            <span id="cimbar-complete-name">-</span>
            <span id="cimbar-complete-rate" class="complete-rate"></span>
          </div>
          <div class="complete-actions">
            <button id="btn-cimbar-download">Download</button>
            <button id="btn-cimbar-another" class="secondary">Receive Another</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Error Banner -->
  <div id="error-banner" class="hidden">
    <span id="error-message"></span>
    <button id="error-dismiss">&times;</button>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
